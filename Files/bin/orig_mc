#!/bin/ash
#

# Switch multicore on or off

if [[ ! -e /proc/ish/defaults/enable_multicore ]]; then
   echo "Not running on iSH-AOK, exiting."
   exit 1
fi

WHO=`whoami`

# execute again as root
if [ "$WHO" != "root" ]; then
     sudo /usr/local/bin/mc $1
     exit 0
fi

function show_status() {
    STATE=`cat /proc/ish/defaults/enable_multicore`
    if [[ "$STATE" = "true" ]]; then 
        echo "on"
    elif [[ "$STATE" = "false" ]]; then 
        echo "off"
    fi
    exit 0
}

function usage() {
    echo
    echo "Switch multicore processing on or off."
    echo "Switching it off improves stability but impacts performance"
    echo
    echo "mc <on|off|status>"
    echo
    echo -n "mc="

    show_status
}

if [[ -z $1 ]]; then 
    usage
    exit 1
fi

# Start options for special cases

if [[ "$1" = "on" ]]; then 
    echo "true" > /proc/ish/defaults/enable_multicore
    exit 0
elif [[ "$1" = "off" ]]; then 
    echo "false" > /proc/ish/defaults/enable_multicore
    exit 0
elif [[ "$1" = "status" ]]; then 
    show_status
fi

echo "Unknown option $1"

exit 1

